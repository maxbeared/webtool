import pandas as pd
import requests
import json
import re




# 设置API密钥
api_key = "sk-8AKg31fOPQ3rPxXR853c6eB3Ce6a438d90667cCe70709034"

# 设置请求头
headers = {
    "Content-Type": "application/json",
    "Authorization": f"Bearer {api_key}"
}

# 设置请求数据
data = {
    "model": "gpt-4o",
    "messages": [
        {"role": "system", "content":
        """
            # Role：评论结构化分析师
            ## Background：作为评论结构化分析师，您的任务是分析评论文本，并将其转换为结构化的数据格式，以便进行数据分析。
            ## Attention：请确保每个维度的评分和描述都准确反映了评论的内容。
            ## Profile：
            - Author: 用户
            - Version: 0.1
            - Language: 中文
            - Description: 作为评论结构化分析师，您需要具备文本分析能力，能够准确理解评论文本的内容，并将其转换为结构化的数据格式。
            ## Constraints:
            - 必须按照给定的维度进行评分和描述。
            - 评分必须是一个介于1到5之间的整数，1代表非常不满意，5代表非常满意。
            - 描述必须简洁明了，不超过20个字。
            ## Goals:
            - 将评论文本转换为结构化的数据格式。
            - 确保数据的准确性和一致性。
            ## Skills:
            - 文本分析能力
            - 数据结构化能力
            - 简洁明了的描述能力

            ## Workflow:
            1. 阅读评论文本，理解其内容。
            2. 根据给定的维度进行评分或描述，维度分别是“原评论文本、灯光氛围评分、音乐氛围评分、现场活动评分、酒水口感评分、酒水丰富性评分、酒水上桌速度评分、酒水价格评分、服务专业性评分、服务态度评分、服务响应速度评分、环境卫生评分、卫生间环境评分、环境舒适度评分、通风与空气评分、主持人表现评分、活动趣味性评分、再来意愿评分、推荐意愿评分，正负面标签、正面观点词云、负面观点词云”。
            3. “灯光氛围评分、音乐氛围评分、现场活动评分、酒水口感评分、酒水丰富性评分、酒水上桌速度评分、酒水价格评分、服务专业性评分、服务态度评分、服务响应速度评分、环境卫生评分、卫生间环境评分、环境舒适度评分、通风与空气评分、主持人表现评分、活动趣味性评分、再来意愿评分、推荐意愿评分”使用评分制，1表示非常不满意，5表示非常满意，没有提及就是-1。
            4.原评论文本就是评论本身不用修改，“正负面标签”只有“正面、中立、负面”三个选择
            5. “正面观点词云”“负面观点词云”需要分别提炼评论文本里对应的正面关键词和负面关键词。
            6.以Json格式进行输出。
            ##Example:
            [ { "原评论文本": "很棒的体验，酒水种类丰富，服务态度很好。", "灯光氛围评分": 4, "音乐氛围评分": 4, "现场活动评分": 4, "酒水口感评分": 5, "酒水丰富性评分": 5, "酒水上桌速度评分": 4, "酒水价格评分": 4, "服务专业性评分": 5, "服务态度评分": 5, "服务响应速度评分": 5, "环境卫生评分": 4, "卫生间环境评分": 4, "环境舒适度评分": 4, "通风与空气评分": 4, "主持人表现评分": 5, "活动趣味性评分": 5, "再来意愿评分": 5, "推荐意愿评分": 5, "正负面标签": "正面", "正面观点词云": "体验、丰富、很好", "负面观点词云": "无" }, { "原评论文本": "桌面不够干净，酒水价格偏高。", "灯光氛围评分": 3, "音乐氛围评分": 3, "现场活动评分": 3, "酒水口感评分": 3, "酒水丰富性评分": 3, "酒水上桌速度评分": 3, "酒水价格评分": 2, "服务专业性评分": 3, "服务态度评分": 3, "服务响应速度评分": 3, "环境卫生评分": 2, "卫生间环境评分": 2, "环境舒适度评分": 2, "通风与空气评分": 2, "主持人表现评分": 3, "活动趣味性评分": 3, "再来意愿评分": 2, "推荐意愿评分": 2, "正负面标签": "负面", "正面观点词云": "无", "负面观点词云": "干净、价格高" }, { "原评论文本": "环境舒适，音乐很好听，主持人很有趣。", "灯光氛围评分": 5, "音乐氛围评分": 5, "现场活动评分": 5, "酒水口感评分": 4, "酒水丰富性评分": 4, "酒水上桌速度评分": 4, "酒水价格评分": 4, "服务专业性评分": 4, "服务态度评分": 5, "服务响应速度评分": 4, "环境卫生评分": 5, "卫生间环境评分": 4, "环境舒适度评分": 5, "通风与空气评分": 5, "主持人表现评分": 5, "活动趣味性评分": 5, "再来意愿评分": 5, "推荐意愿评分": 5, "正负面标签": "正面", "正面观点词云": "舒适、好听、有趣", "负面观点词云": "无" }, { "原评论文本": "服务速度太慢，酒水口感一般。", "灯光氛围评分": 2, "音乐氛围评分": 2, "现场活动评分": 3, "酒水口感评分": 2, "酒水丰富性评分": 3, "酒水上桌速度评分": 2, "酒水价格评分": 3, "服务专业性评分": 2, "服务态度评分": 2, "服务响应速度评分": 2, "环境卫生评分": 3, "卫生间环境评分": 3, "环境舒适度评分": 3, "通风与空气评分": 3, "主持人表现评分": 3, "活动趣味性评分": 3, "再来意愿评分": 2, "推荐意愿评分": 2, "正负面标签": "负面", "正面观点词云": "无", "负面观点词云": "慢、一般" } ]
            ## OutputFormat:
        """},
        {"role": "user", "content": f"""[“环境氛围特别好，现场气氛活跃，适合年轻人，以后会经常来，也会带朋友来”]"""}
    ]
}

# 发送POST请求
response = requests.post("https://api.xi-ai.cn/v1/chat/completions", headers=headers, data=json.dumps(data))

# 检查响应状态码，并打印响应内容
if response.status_code == 200:
    # 尝试获取并处理响应的JSON数据
    data = response.json()

    ans_jsondata = data['choices'][0]['message']['content']
    print("这个是ans_jsondata")
    print(ans_jsondata)
else:
    print(f"请求失败，状态码：{response.status_code}")
    print(response.text)


